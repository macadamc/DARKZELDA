<?xml version="1.0" encoding="utf-8" ?>
<c2eventsheet>
    <!--All the 'name' attributes are ignored by Construct 2 - they are there for readability only.-->
    <name>NpcStates</name>
    <events>
        <event-group description="" sid="1117861807545207" title="NEWPATH">
            <sub-events>
                <event-block sid="6420539968257238">
                    <conditions>
                        <condition behavior="Pathfinding" id="5" name="On arrived" sid="2262432558795798" type="NPC" />
                        <condition id="-14" name="Pick by unique ID" sid="375765421704153" type="NPCData">
                            <param id="0" name="Unique ID">NPC.DataUID</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <event-block sid="7728437657344882">
                            <conditions>
                                <condition id="3" name="Has key" sid="644696990836454" type="NPCData">
                                    <param id="0" name="Key">&quot;AddFlag&quot;</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="0" name="Add key" sid="5736702105495919" type="GameStats">
                                    <param id="0" name="Key">npcdata.Get(&quot;AddFlag&quot;)</param>
                                    <param id="1" name="Value">1</param>
                                </action>
                                <action id="2" name="Delete key" sid="8277271431092865" type="NPCData">
                                    <param id="0" name="Key">&quot;AddFlag&quot;</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="8274613814208896">
                            <conditions>
                                <condition id="3" name="Has key" sid="9614381986741636" type="NPCData">
                                    <param id="0" name="Key">&quot;DeleteFlag&quot;</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="2" name="Delete key" sid="6134889950467024" type="GameStats">
                                    <param id="0" name="Key">npcdata.Get(&quot;DeleteFlag&quot;)</param>
                                </action>
                                <action id="2" name="Delete key" sid="8667523444625452" type="NPCData">
                                    <param id="0" name="Key">&quot;DeleteFlag&quot;</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="6126044243023437">
                            <conditions>
                                <condition id="3" name="Has key" sid="9508043983697824" type="NPCData">
                                    <param id="0" name="Key">&quot;DestroyNPC&quot;</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Destroy" sid="7500263756268574" type="NPC" />
                            </actions>
                        </event-block>
                        <event-block sid="5602498591504502">
                            <conditions />
                            <actions>
                                <action id="-16" name="Wait" sid="2944936756172569" type="System">
                                    <param id="0" name="Seconds">random(1,4)</param>
                                </action>
                                <action id="2" name="Delete key" sid="7461366667343992" type="NPCData">
                                    <param id="0" name="Key">&quot;walkToX&quot;</param>
                                </action>
                                <action id="2" name="Delete key" sid="2958068179601654" type="NPCData">
                                    <param id="0" name="Key">&quot;walkToY&quot;</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="2419818586270047">
                    <conditions>
                        <condition behavior="Pathfinding" id="1" name="On failed to find path" sid="836993569073456" type="NPC" />
                    </conditions>
                    <actions>
                        <action id="2" name="Delete key" sid="5623742773955754" type="NPCData">
                            <param id="0" name="Key">&quot;walkToX&quot;</param>
                        </action>
                        <action id="2" name="Delete key" sid="4774379066628733" type="NPCData">
                            <param id="0" name="Key">&quot;walkToY&quot;</param>
                        </action>
                    </actions>
                </event-block>
                <event-block sid="2295897494789298">
                    <conditions>
                        <condition behavior="Pathfinding" id="0" name="On path found" sid="2475246002575775" type="NPC" />
                    </conditions>
                    <actions>
                        <action behavior="Pathfinding" id="1" name="Move along path" sid="3721628701264464" type="NPC" />
                    </actions>
                </event-block>
                <event-block sid="7517956442780479">
                    <conditions>
                        <condition id="-8" name="Is boolean instance variable set" sid="8476688801063963" type="NpcBase">
                            <param id="0" name="Instance variable">HasSprite</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="4" name="Set animation" sid="5749270052499785" type="NpcSprite">
                            <param id="0" name="Animation">NpcBase.SpriteName</param>
                            <param id="1" name="From">1</param>
                        </action>
                    </actions>
                    <sub-events>
                        <event-block sid="5473795529690852">
                            <conditions>
                                <condition id="-8" name="Compare two values" sid="6279130564975222" type="System">
                                    <param id="0" name="First value">npcBase.pathfinding.NodeXAt(npcBase.pathfinding.CurrentNode)</param>
                                    <param id="1" name="Comparison">4</param>
                                    <param id="2" name="Second value">npcBase.X</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="7" name="Set mirrored" sid="7481133580855106" type="NpcSprite">
                                    <param id="0" name="State">1</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="18970364666737">
                            <conditions>
                                <condition id="-8" name="Compare two values" sid="5747505683559774" type="System">
                                    <param id="0" name="First value">npcBase.pathfinding.NodeXAt(npcBase.pathfinding.CurrentNode)</param>
                                    <param id="1" name="Comparison">2</param>
                                    <param id="2" name="Second value">npcBase.X</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="7" name="Set mirrored" sid="192031654696513" type="NpcSprite">
                                    <param id="0" name="State">0</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="6379156983382026">
                    <conditions>
                        <condition id="0" name="On function" sid="9197085068048106" type="Function">
                            <param id="0" name="Name">&quot;Npc_Move&quot;</param>
                        </condition>
                        <condition id="-14" name="Pick by unique ID" sid="1365147697194333" type="NPC">
                            <param id="0" name="Unique ID">Function.Param(2)</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <variable constant="0" name="Animate" sid="8598556283722171" static="0" type="number">0</variable>
                        <event-block sid="4130770417784985">
                            <conditions>
                                <condition id="1" name="Compare parameter" sid="2389687005796026" type="Function">
                                    <param id="0" name="Index">0</param>
                                    <param id="1" name="Comparison">1</param>
                                    <param id="2" name="Value">NPC.X</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Set value" sid="154523166230144" type="System">
                                    <param id="0" name="Variable">Animate</param>
                                    <param id="1" name="Value">1</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="3494913634506221">
                            <conditions>
                                <condition id="1" name="Compare parameter" sid="476932054764783" type="Function">
                                    <param id="0" name="Index">1</param>
                                    <param id="1" name="Comparison">1</param>
                                    <param id="2" name="Value">NPC.Y</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Set value" sid="2232711857636001" type="System">
                                    <param id="0" name="Variable">Animate</param>
                                    <param id="1" name="Value">1</param>
                                </action>
                            </actions>
                        </event-block>
                        <event-block sid="9869651876344356">
                            <conditions>
                                <condition id="-14" name="Compare variable" sid="9119658723054875" type="System">
                                    <param id="0" name="Variable">Animate</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Value">1</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="8283875004801188">
                                    <conditions>
                                        <condition id="-8" name="Is boolean instance variable set" sid="9237645246390936" type="NPC">
                                            <param id="0" name="Instance variable">regenMap</param>
                                        </condition>
                                        <condition id="-14" name="Pick by unique ID" sid="6993585308446898" type="CameraZone">
                                            <param id="0" name="Unique ID">CurZone</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action behavior="Pathfinding" id="16" name="Regenerate region around object" sid="3513314725212966" type="NPC">
                                            <param id="0" name="Object">CameraZone</param>
                                        </action>
                                        <action id="-13" name="Set boolean" sid="7269437327933483" type="NPC">
                                            <param id="0" name="Instance variable">regenMap</param>
                                            <param id="1" name="Value">0</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <event-block sid="3556499906088691">
                                    <conditions>
                                        <condition behavior="Pathfinding" id="3" inverted="1" name="Is calculating path" sid="4152134446140468" type="NPC" />
                                        <condition behavior="Pathfinding" id="4" inverted="1" name="Is moving along path" sid="2021983609741286" type="NPC" />
                                        <condition id="-4" name="Trigger once while true" sid="8680631026920521" type="System" />
                                    </conditions>
                                    <actions>
                                        <action behavior="Pathfinding" id="0" name="Find path" sid="9213442787217203" type="NPC">
                                            <param id="0" name="X">function.Param(0)</param>
                                            <param id="1" name="Y">function.Param(1)</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                    </sub-events>
                </event-block>
                <event-block sid="5989504239218239">
                    <conditions>
                        <condition id="0" name="On function" sid="8889499779571004" type="Function">
                            <param id="0" name="Name">&quot;Npc_RandomWalk&quot;</param>
                        </condition>
                        <condition id="-14" name="Pick by unique ID" sid="2851059125936896" type="NPC">
                            <param id="0" name="Unique ID">Function.Param(0)</param>
                        </condition>
                        <condition id="-14" name="Pick by unique ID" sid="5409515286134794" type="NPCData">
                            <param id="0" name="Unique ID">NPC.DataUID</param>
                        </condition>
                        <condition id="-14" name="Pick by unique ID" sid="954343921733254" type="FSM">
                            <param id="0" name="Unique ID">NPC.FSM_UID</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <comment>pick a random spot in a list of camrea zones. delimited by a space.</comment>
                        <event-block sid="4165328210713075">
                            <conditions>
                                <condition id="3" inverted="1" name="Has key" sid="6583549311643823" type="NPCData">
                                    <param id="0" name="Key">&quot;walkToX&quot;</param>
                                </condition>
                                <condition id="3" inverted="1" name="Has key" sid="3286027012189848" type="NPCData">
                                    <param id="0" name="Key">&quot;walkToY&quot;</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <comment>This event picks a random object from the Bounds attribute in the npcState and then finds a random spot in it and sets some values to move to</comment>
                                <event-block disabled="1" sid="7624651656571713">
                                    <conditions>
                                        <condition id="3" name="Has key" sid="428890325837642" type="NPCData">
                                            <param id="0" name="Key">&quot;Bounds&quot;</param>
                                        </condition>
                                        <condition id="-14" name="Pick by unique ID" sid="7522007579324176" type="PathZone">
                                            <param id="0" name="Unique ID">int(tokenat(NpcData.Get(&quot;Bounds&quot;),random(tokencount(NpcData.Get(&quot;Bounds&quot;),&quot; &quot;)),&quot; &quot;))</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Add key" sid="929258548079748" type="NPCData">
                                            <param id="0" name="Key">&quot;walkToX&quot;</param>
                                            <param id="1" name="Value">int(random(PathZone.BBoxLeft, PathZone.BBoxRight))</param>
                                        </action>
                                        <action id="0" name="Add key" sid="6315765219667151" type="NPCData">
                                            <param id="0" name="Key">&quot;walkToY&quot;</param>
                                            <param id="1" name="Value">int(random(PathZone.BBoxTop, PathZone.BBoxBottom))</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <event-block sid="4264156219678899">
                                    <conditions>
                                        <condition id="3" name="Has key" sid="2373198876586121" type="NPCData">
                                            <param id="0" name="Key">&quot;Bounds&quot;</param>
                                        </condition>
                                        <condition id="-33" name="Pick by comparison" sid="3012763829924939" type="System">
                                            <param id="0" name="Object">PathZone</param>
                                            <param id="1" name="Expression">pathzone.tag</param>
                                            <param id="2" name="Comparison">0</param>
                                            <param id="3" name="Value">NpcData.Get(&quot;Bounds&quot;)</param>
                                        </condition>
                                        <condition id="-16" name="Pick random instance" sid="3748514694510401" type="System">
                                            <param id="0" name="Object">PathZone</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Add key" sid="1888717092849854" type="NPCData">
                                            <param id="0" name="Key">&quot;walkToX&quot;</param>
                                            <param id="1" name="Value">int(random(PathZone.BBoxLeft, PathZone.BBoxRight))</param>
                                        </action>
                                        <action id="0" name="Add key" sid="3433323400561805" type="NPCData">
                                            <param id="0" name="Key">&quot;walkToY&quot;</param>
                                            <param id="1" name="Value">int(random(PathZone.BBoxTop, PathZone.BBoxBottom))</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <comment>if we have a random target then we can try to move to it.</comment>
                        <event-block sid="8839165206281633">
                            <conditions>
                                <condition id="-22" name="Else" sid="8312084285862589" type="System" />
                                <condition behavior="Pathfinding" id="4" inverted="1" name="Is moving along path" sid="4279438694706556" type="NPC" />
                                <condition behavior="Pathfinding" id="3" inverted="1" name="Is calculating path" sid="9064929116895195" type="NPC" />
                            </conditions>
                            <actions>
                                <action id="0" name="Call function" sid="4302931094368951" type="Function">
                                    <param id="0" name="Name">&quot;Npc_Move&quot;</param>
                                    <param id="1" name="Parameter {n}">NPCData.Get(&quot;walkToX&quot;){###}NPCData.Get(&quot;walkToY&quot;){###}NPC.UID</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-group>
        <event-block sid="7720662209762489">
            <conditions>
                <condition id="0" name="On function" sid="4793558065289105" type="Function">
                    <param id="0" name="Name">&quot;FollowTarget&quot;</param>
                </condition>
                <condition id="-14" name="Pick by unique ID" sid="5144629104569908" type="NPC">
                    <param id="0" name="Unique ID">Function.Param(0)</param>
                </condition>
                <condition id="-14" name="Pick by unique ID" sid="6888497362861699" type="NPCData">
                    <param id="0" name="Unique ID">NPC.DataUID</param>
                </condition>
                <condition id="-14" name="Pick by unique ID" sid="8577782927805419" type="FSM">
                    <param id="0" name="Unique ID">NPC.FSM_UID</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <event-block sid="439694429425023">
                    <conditions>
                        <condition behavior="Pathfinding" id="4" inverted="1" name="Is moving along path" sid="3064614953871004" type="NPC" />
                        <condition behavior="Pathfinding" id="3" inverted="1" name="Is calculating path" sid="3017406740179517" type="NPC" />
                        <condition id="-14" name="Pick by unique ID" sid="6573335415499685" type="PointsOfIntrest">
                            <param id="0" name="Unique ID">int(NPCData.Get(&quot;Target&quot;))</param>
                        </condition>
                        <condition id="-33" name="Pick by comparison" sid="2764195977681249" type="System">
                            <param id="0" name="Object">PathZone</param>
                            <param id="1" name="Expression">PathZone.tag</param>
                            <param id="2" name="Comparison">0</param>
                            <param id="3" name="Value">NPCData.Get(&quot;Bounds&quot;)</param>
                        </condition>
                        <condition id="1" name="Is overlapping another object" sid="9492678278803614" type="PointsOfIntrest">
                            <param id="0" name="Object">PathZone</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="0" name="Call function" sid="775320910399303" type="Function">
                            <param id="0" name="Name">&quot;Npc_Move&quot;</param>
                            <param id="1" name="Parameter {n}">PointsOfIntrest.X{###}PointsOfIntrest.Y{###}NPC.UID</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-block>
    </events>
</c2eventsheet>
